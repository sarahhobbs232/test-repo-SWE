<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment | Eternal Elixirs</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.png') }}">
</head>
<body style="background-color: rgb(145,165,152); font-family: cursive;">

<nav class="navbar navbar-expand-md navbar-dark navbar-ee">
    <div class="container">

        <img src="{{ url_for('static', filename='images/logo.png') }}"
         alt="logo"
         class="me-3 brand-logo">


        <a href="{{ url_for('shop.shop_home') }}" class="navbar-brand" style="font-family: cursive;">
            Eternal Elixirs
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navmenu">
            <ul class="navbar-nav ms-auto">

                <li class="nav-item">
                    <a href="{{ url_for('shop.shop_home') }}" class="nav-link">Home</a>
                </li>

                <li class="nav-item">
                    <a href="{{ url_for('cart.view_cart') }}" class="nav-link">Shopping Cart</a>
                </li>

                {% if session.get("user_id") %}
                    <!-- Show Account instead of Login/Register when logged in -->
                    <li class="nav-item">
                        <a href="{{ url_for('auth.account') }}" class="nav-link">Account</a>
                    </li>

                    {% if session.get("user_type") == "Admin" %}
                        <!-- NEW: direct link to admin dashboard -->
                        <li class="nav-item">
                            <a href="{{ url_for('admin.dashboard') }}" class="nav-link">Admin</a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('admin.sales_report') }}" class="nav-link">Sales Report</a>
                        </li>
                    {% endif %}

                    <li class="nav-item">
                        <a href="{{ url_for('auth.logout') }}" class="nav-link">Logout</a>
                    </li>
                {% else %}
                    <!-- Not logged in: show Login + Register -->
                    <li class="nav-item">
                        <a href="{{ url_for('auth.login') }}" class="nav-link">Login</a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('auth.register') }}" class="nav-link">Register</a>
                    </li>
                {% endif %}

            </ul>
        </div>
    </div>
</nav>

<!-- Flash messages -->
<div class="container mt-3">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-info" role="alert">
          {% for msg in messages %}
            <div>{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
</div>


<div class="container my-4">
    <h2>Payment</h2>

    <div class="row">
        <!-- Payment form -->
        <div class="col-lg-7">
            <div class="p-3 rounded" style="background-color:#d4b1d3;">
                <h4 class="mb-3">Enter Payment Details</h4>

                <form method="post" action="{{ url_for('checkout.process_payment') }}">
                    <!-- fake payment fields -->
                    <div class="mb-3">
                        <label class="form-label">Card Number</label>
                        <input type="text"
                               name="card_number"
                               class="form-control"
                               placeholder="1234 5678 9012 3456"
                               autocomplete="off">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Expiration Date</label>
                        <input type="text"
                               name="exp_date"
                               class="form-control"
                               placeholder="MM/YY"
                               autocomplete="off">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">CVV</label>
                        <input type="text"
                               name="cvv"
                               class="form-control"
                               placeholder="123"
                               autocomplete="off"
                               maxlength="3"
                               inputmode="numeric"
                               pattern="\d{3}">

                    </div>

                    <!-- hidden address + shipping fields -->
                    <input type="hidden" name="street" value="{{ street }}">
                    <input type="hidden" name="city" value="{{ city }}">
                    <input type="hidden" name="state" value="{{ state }}">
                    <input type="hidden" name="zip" value="{{ zip_code }}">
                    <input type="hidden" name="shipping_id" value="{{ shipping_id }}">

                    <button type="submit" class="btn btn-primary mt-2">Place Order</button>
                </form>
            </div>
        </div>

        <!-- Order summary -->
        <div class="col-lg-5">
            <div class="p-3 rounded" style="background-color:#f6f1f7;">
                <h4>Order Summary</h4>

                <ul class="list-group mb-3">
                    {% for item in items %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>{{ item.name }}</span>
                            <span>${{ "%.2f"|format(item.price) }}</span>
                        </li>
                    {% endfor %}
                </ul>

                <p class="mb-1">Shipping: {{ shipping_type }} (${{ "%.2f"|format(shipping_cost) }})</p>
                <p class="mb-1">Subtotal: ${{ "%.2f"|format(subtotal) }}</p>
                <p class="mb-1">Tax: ${{ "%.2f"|format(tax) }}</p>
                <p class="fw-bold">Total: ${{ "%.2f"|format(total) }}</p>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const cardInput = document.querySelector('input[name="card_number"]');
    const expInput  = document.querySelector('input[name="exp_date"]');

    // Format: xxxx xxxx xxxx xxxx
    if (cardInput) {
        cardInput.addEventListener('input', function () {
            // Remove non-digits and limit to 16
            let digits = this.value.replace(/\D/g, '').slice(0, 16);
            let parts = [];
            for (let i = 0; i < digits.length; i += 4) {
                parts.push(digits.substring(i, i + 4));
            }
            this.value = parts.join(' ');
        });
    }

    // Format: xx/xx
    if (expInput) {
        expInput.addEventListener('input', function () {
            let digits = this.value.replace(/\D/g, '').slice(0, 4);

            if (digits.length >= 3) {
                this.value = digits.slice(0, 2) + '/' + digits.slice(2);
            } else {
                this.value = digits;
            }
        });
    }
});
</script>

</body>
</html>
